<!DOCTYPE html>
<html lang="de">
<head>
  <style>
    body {
      background-image: url('pic33transparent.jpg');
      background-size: cover;                      /* Bild skaliert auf Fenstergr√∂√üe */
      background-repeat: no-repeat;                /* Wiederholt das Bild nicht */
      background-position: top center;             /* Zentriert das Bild */
    }
  </style>
</head>
<head>
  <meta charset="UTF-8">
  <title>W√ºrfelaktion mit Effekten</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <style>
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 410px;
    }
    #editButton, #globalEditButton, #toggleStatsButton, #settingsButton {
      position: absolute;
      left: 20px;
      padding: 8px 16px;
      font-size: 14px;
    }
    #editButton { top: 320px; }
    #toggleStatsButton { top: 360px; }
    #globalEditButton { top: 400px; }
    #settingsButton { top: 440px; }

    .dice-container {
      font-size: 80px;
      margin: 20px;
    }
    .dice {
      display: inline-block;
      margin: 0 20px;
      cursor: pointer;
    }
    #dice2 {
      color: red;                                    /* W√ºrfelfarbefarbe rot */
    }
    #dice3, #dice4 {
      font-size: 54px;                              /* W√ºrfelgr√∂√üe */
      vertical-align: middle;
    }
    .dice:hover {
      transform: scale(1.2);
      transition: transform 0.2s ease;
    }
    canvas {
      max-width: 100%;
    }
    #effectBox {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      background: #fffdf7;
      border: 3px solid #e67e22;
      border-radius: 12px;
      padding: 30px;
      width: 90vw;
      max-width: 400px;
      height: 300px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      text-align: center;
      display: none;
    }
    #effectText {
      font-size: 20px;
      color: #e67e22;
      margin-bottom: 20px;
    }
    #editArea, #globalEditArea {
      display: none;
      text-align: left;
      margin: 20px auto;
      max-width: 400px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #globalEditArea { background-color: #eef; }
    #resetStatsBtn {
      margin-top: 10px;
      font-size: 14px;
      padding: 5px 10px;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    #settingsMenu {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #f8f8f8;
      border: 2px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      z-index: 9999;
      width: 300px;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.6);
      z-index: 0;
      pointer-events: none;
    }
    #dropdownContainer {
  position: fixed;
  top: 30px;
  right: 30px;
  z-index: 1;
}

#dropdownToggle {
  background-color: #f0f0f0;
  border: none;
  font-size: 40px;
  padding: 10px 14px;
  cursor: pointer;
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

#dropdownMenu {
  display: none;
  position: absolute;
  top: 70px;
  right: 0;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 15px;
  padding: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  text-align: left;
  min-width: 500px;
}

#dropdownMenu button {
  line-height: 2.0;
  display: block;
  width: 100%;
  background: none;
  border: none;
  text-align: left;
  padding: 8px;
  font-size: 30px;
  cursor: pointer;
}

#dropdownMenu button:hover {
  background-color: #f5f5f5;
}

  </style>
</head>
<body>
  <!-- Zahnrad-Men√º -->
  <div id="dropdownContainer">
    <button id="dropdownToggle">‚öôÔ∏è</button>
    <div id="dropdownMenu">
      <button onclick="toggleEdit()">Effekte bearbeiten</button>
      <button onclick="toggleGlobalEdit()">Globale Effekte bearbeiten</button>
      <button onclick="toggleStats()">üìâ Statistiken ein-/ausblenden</button>
      <button onclick="resetStats()">üìâ Statistik zur√ºcksetzen</button>
      <button onclick="toggleSettings()">‚öôÔ∏è Einstellungen</button>
    </div>
  </div>

  <!-- Zentrierter Inhaltsbereich -->
  <div id="mainContent">
    <div class="dice-container">
      <!-- ... alle W√ºrfel etc. ... -->
    </div>
    <!-- ... alles Weitere ... -->
  </div>

  <div id="settingsMenu">
    <h3>Einstellungen</h3>
    <label><input type="checkbox" id="toggleNormalDice" checked> Normale W√ºrfel</label><br>
    <label><input type="checkbox" id="toggleBarbarianDice" checked> Barbarenw√ºrfel</label><br>
    <label><input type="checkbox" id="toggleGuildDice" checked> Handelsgildenw√ºrfel</label><br>
    <label><input type="checkbox" id="toggleSevenEffects" checked> Effekte bei 7</label><br>
    <label><input type="checkbox" id="toggleGlobalEffects" checked> Globale Effekte</label><br><br>
    <button onclick="saveSettings()">Speichern</button>
    <button onclick="toggleSettings()">Schlie√üen</button>
  </div>

  <h1>W√ºrfelaktion</h1>
  <div class="dice-container">
    <div class="dice" id="dice1" onclick="rollDice()">üé≤</div>
    <div class="dice" id="dice2" onclick="rollDice()">üé≤</div>
    <div class="dice" id="dice3" onclick="rollDice()">üü°</div>
    <div class="dice" id="dice4" onclick="rollDice()">üîµ</div>
  </div>
  <p id="result"></p>
  <p id="thirdResult"></p>
  <p id="fourthResult"></p>
  <div id="effectBox">
    <div id="effectTitle" style="font-size: 22px; font-weight: bold; color: #d35400; margin-bottom: 20px;"></div>
    <div id="effectText" style="font-size: 16px;"></div>
    <button onclick="closeEffect()" style="position: absolute; bottom: 20px; right: 20px; font-size: 20px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer;">‚úî</button>
  </div>

  <div id="globalEditArea">
    <h3>Globale Effekte (einer pro Zeile):</h3>
    <textarea id="globalEffectInput" placeholder="Jeder globale Effekt in eine neue Zeile schreiben..."></textarea><br>
    <button onclick="saveGlobalEffects()" style="margin-top: 10px;">Speichern</button>
  </div>

  <div id="editArea">
    <h3>Effekte f√ºr Summe 7 (einer pro Zeile):</h3>
    <textarea id="effectInput" placeholder="Jeder Effekt in eine neue Zeile schreiben..."></textarea><br>
    <button onclick="saveEffects()" style="margin-top: 10px;">Speichern</button>
  </div>

  <div id="globalEffectBox" style="display:none; margin: 20px auto; max-width: 600px; font-size: 18px; padding: 10px; border: 2px solid #555; background: #eef7ff; font-weight: bold; border-radius: 10px;"></div>

  <div id="statsContainer" style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
    <div style="width: 550px; height: 400px;">
      <canvas id="statsChart"></canvas>
    </div>
    <div style="width: 400px; height: 300px;">
      <canvas id="thirdDiceChart"></canvas>
    </div>
    <div style="width: 400px; height: 300px;">
      <canvas id="fourthDiceChart"></canvas>
    </div>
  </div>

  <script>
    function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);               // Stimme ausw√§hlen
    const selectedVoice = speechSynthesis.getVoices().find(voice => voice.lang === 'de-DE');
    if (selectedVoice) utterance.voice = selectedVoice;
    speechSynthesis.speak(utterance);
  }

    let settings = JSON.parse(localStorage.getItem("diceSettings")) || {
      normalDice: true,
      barbarianDice: true,
      guildDice: true,
      effectsOnSeven: true,
      globalEffects: true
    };

    function toggleSettings() {
      const menu = document.getElementById("settingsMenu");
      document.getElementById("toggleNormalDice").checked = settings.normalDice;
      document.getElementById("toggleBarbarianDice").checked = settings.barbarianDice;
      document.getElementById("toggleGuildDice").checked = settings.guildDice;
      document.getElementById("toggleSevenEffects").checked = settings.effectsOnSeven;
      document.getElementById("toggleGlobalEffects").checked = settings.globalEffects;
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    }

    function saveSettings() {
      settings.normalDice = document.getElementById("toggleNormalDice").checked;
      settings.barbarianDice = document.getElementById("toggleBarbarianDice").checked;
      settings.guildDice = document.getElementById("toggleGuildDice").checked;
      settings.effectsOnSeven = document.getElementById("toggleSevenEffects").checked;
      settings.globalEffects = document.getElementById("toggleGlobalEffects").checked;
      localStorage.setItem("diceSettings", JSON.stringify(settings));
      document.getElementById("settingsMenu").style.display = "none";
    }
    const diceFaces = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
    const thirdDiceFaces = ['Vorr√ºcken','Stehenbleiben'];
    const fourthDiceColors = ['üîµ','üü°','üü¢','üü£','üî¥','‚ö´'];
    const fourthDiceNames = ['Geldsack Handelsgilde','gelbe','gr√ºne','pinke','rote','schwarze'];

    let effects = JSON.parse(localStorage.getItem("sevenEffects")) || [
      "Knappheit:Jeder Spieler w√§hlt eine Rohstoff- oder Handelswarenkarte und gibt sie ab. Sie wird in den Vorrat zur√ºckgelegt.", 
      "Ein Wirbelsturm zieht auf:Jeder Spieler w√ºrfelt mit einem W√ºrfel. Bei 1‚Äì2 muss er eine Stra√üe oder ein Schiff vom Spielplan entfernen fals m√∂glich.", 
      "Korruption:Versetze den R√§uber ganz normal, zus√§tzlich muss jeder Spieler eine Fortschrittskarte abgeben.", 
      "Feuer im Lager:Jeder Spieler muss einen Rohstoff und eine Handelsware abgeben. Wer nichts hat muss auch nichts abgeben.", 
      "Unruhe:Versetze den R√§uber ganz normal, zus√§tzlich wird der st√§rkste Ritter jedes Spielers deaktiviert.", 
      "Kriegsgewinnler:Der R√§uberw√ºrfler darf sich einen Rohstoff und eine Handelsware von jedem Spieler w√ºnschen.", 
      "Heimliche F√∂rderung:Der W√ºrfler darf eine Fortschrittskarte ziehen, auch wenn er keinen Stadtausbau hat. Daf√ºr muss der W√ºrfler 3 beliebige Rohstoffe/Handelswaren abgeben.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Tuch.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Geldsack.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Papier.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Zauberstein.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Brot.", 
      "Schatz gefunden:Versetze den R√§uber ganz normal, zus√§tzlich erh√§lst du 1 Salz.", 
      "D√ºrre:Jeder Spieler muss die h√§lfte seiner Getreide und seiner Brotvorr√§te abgeben (mindestens 1).", 
      "Erdrutsch:Jeder Spieler muss die h√§lfte seiner Lehm und seiner Zaubersteinvorr√§te abgeben (mindestens 1).", 
      "Waldbrand:Jeder Spieler muss die h√§lfte seiner Holz und seiner Papiervorr√§te abgeben (mindestens 1).", 
      "Einsturz:Jeder Spieler muss die h√§lfte seiner Erz und seiner Geldsackvorr√§te abgeben (mindestens 1).", 
      "Seuche:Jeder Spieler muss die h√§lfte seiner Wolle und seiner Tuchvorr√§te abgeben (mindestens 1).", 
      "Revolte in der Stadt:Eine der St√§dte des R√§uberw√ºrflers entwickelt sich zur√ºck zur Siedlung (freie Wahl). Er darf sich drei Rohstoffe von der Bank aussuchen.", 
      "Steuerschuld:Jeder Spieler muss die H√§lfte seiner Handkarten abgeben egal wie viele er hat.", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "R√§uber:Versetze den R√§uber ganz normal", 
      "√úberfall auf das Lager:Jeder Spieler gibt einen zuf√§llige Handkarte an den linken Nachbarn ab.", 
      "Aufstand der Bauern:Versetze den R√§uber ganz normal, zus√§tzlich verlieren alle St√§dte bis zu deinem n√§chsten Zug ihre Handelswaren-Produktion.", 
      "Handelssperre:Spieler d√ºrfen bis zur n√§chsten 7 nicht mehr untereinander handeln. Handeln mit der Bank und dem H√§ndler ist weiterhin erlaubt.", 
      "Bestechung:Versetze den R√§uber ganz normal, zus√§tzlich darf der W√ºrfler einen Ritter deaktivieren und einen anderen daf√ºr aktivieren.", 
      "Barbaren√ºberfall!:Die Barbaren r√ºcken sofort 1 Feld vor, zus√§tzlich zur normalen Bewegung.", 
      "Rohstoffroulette:Alle Handkarten auf den Tisch, mischen, umverteilen. Startend mit dem R√§uberw√ºrfler", 
      "Vertauschung der Sch√§tze:Jeder Spieler gibt seine Handkarten dem Spieler rechts von sich.", 
      "Vertauschung der Sch√§tze:Jeder Spieler gibt seine Handkarten dem Spieler links von sich.", 
      "Der Schwarzmarkt:Jeder Spieler darf einen Handel 1:1 mit dem Vorrat machen, egal welche Ware.", 
      "Hungerzeit:Spieler mit 2 oder mehr St√§dten verlieren 1 Rohstoff pro Stadt die sie besitzen.", 
      "Tauschb√∂rse:Jeder Spieler gibt zwei Handkarten verdeckt an die Mitte. Dann zieht jeder Spieler eine Karte beginnend mit dem R√§uberw√ºrfler bis die Karten aufgebraucht sind.", 
      "Ritter-Meuterei:Versetze den R√§uber ganz normal, zus√§tzlich wird der st√§rkste Ritter jedes Spielers deaktiviert.", 
      "Barbarenalarm:Die Barbaren greifen sofort an, als w√ºrde der Barbarenindikator voll sein ‚Äì Angriff nach normalen Regeln.", 
      "Falscher Alarm:Versetze den R√§uber ganz normal, zus√§tzlich ziehen sich die Barbarenh um 1 Feld zur√ºck.", 
      "S√∂ldneraufstand:Jeder aktive Ritter kostet sofort 1 Rohstoff deiner Wahl, sonst wird er deaktiviert.", 
      "Erntefest:Alle Felder mit der Zahl 8 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 9 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 10 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 6 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 5 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 4 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 11 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 3 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Erntefest:Alle Felder mit der Zahl 2 und 12 produzieren sofort einen Rohstoff. Diese Karten werden gemischt und anschlie√üend verteilt - beginnend mit dem R√§uberw√ºrfler - bis die Karten aufgebraucht sind.", 
      "Doppelte R√§uberaktion:Der R√§uberw√ºrfler darf zwei verschiedene Spieler bestehlen. Die Bestohlenen Spieler d√ºrfen den R√§uber versetzen aber keine Karte stehlen (jeder einen R√§uber).", 
      "Ertragssperre:Bestimme beim n√§chsten W√ºrfelzug ob die Zahl gespielt wird oder neu gew√ºrfelt (alle W√ºrfel).", 
      "Fluch der 7:Versetze den R√§uber, diesmal darfst du von jedem anliegenden zwei Karten stehlen."
    ];
    let globalEffects = JSON.parse(localStorage.getItem("globalEffects")) || [
        "Wenn du leer ausgehst nimm dir einen beliebigen Rohstoff zus√§tzlich zu anderen Effekten.",
        "Lehmbr√ºche und Erzmienen produzieren keine Handelswaren mehr,nimm dir stattdessen zwei Rohstoffe.",
        "W√§lder und Meere produzieren keine Handelswaren mehr, nimm dir stattdessen zwei Rohstoffe.",
        "Weizenfelder und Weiden produzieren keine Handelswaren mehr, nimm dir stattdessen zwei Rohstoffe.",
        "Der Spieler mit den wenigsten Siegpunkten darf St√§dte und Siedlungen einen Rohstoff g√ºnstiger bauen.",
        "Statt einer Fortschrittskarte erh√§lt man zwei, z√§hlt nur f√ºr den aktiven Spieler.",
        "Lehmbr√ºche liefern keine Waren mehr!",
        "Erzmienen liefern keine Waren mehr!",
        "Forste liefern keine Waren mehr!",
        "Weiden liefern keine Waren mehr!",
        "Getreidefelder liefern keine Waren mehr!",
        "K√ºstengebiete liefern keine Waren mehr!",
        "Es darf keinen Handel unter den Spielern mehr geben.",
        "H√§fen ben√∂tigen einen Rohstoff mehr zum Handeln.",
        "Addiere zu allen W√ºrfelergebnissen 2 dazu. Die 11 wird zur 2, die 12 zur 3.",
        "Subtrahiere von allen W√ºrfelergebnissen 2. Die 3 wird zur 12, die 2 zur 11.",
        "Funktion von Stadt und Siedlung tauschen ihre Rollen.",
        "Siedlungen produzieren jetzt zwei Rohstoffe, St√§dte zwei Handelswaren."
    ];

    let stats = JSON.parse(localStorage.getItem("diceStats")) || Array(11).fill(0);
    let thirdDiceStats = JSON.parse(localStorage.getItem("thirdDiceStats")) || [0, 0];
    let fourthDiceStats = JSON.parse(localStorage.getItem("fourthDiceStats")) || Array(6).fill(0);

    let totalRolls = 0;
    let lastGlobalEffect = "";
    let rollingDisabled = false;

const statsChart = new Chart(document.getElementById('statsChart'), {
  type: 'bar',
  data: {
    labels: Array.from({length: 11}, (_, i) => (i + 2).toString()),
    datasets: [{
      label: 'H√§ufigkeit der gew√ºrfelten Summe',
      data: stats,
      backgroundColor: 'rgba(54, 162, 235, 0.7)',
      borderColor: 'rgba(54, 162, 235, 1)',
      borderWidth: 1
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1,
          color: '#000',
          font: {
            size: 27,
            weight: 'bold'
          }
        }
      },
      x: {
        ticks: {
          color: '#000',
          font: {
            size: 27,
            weight: 'bold'
          }
        }
      }
    },
    plugins: {
      legend: {
        labels: {
          color: '#000',
          font: {
            weight: 'bold',
            size: 27
          }
        }
      }
    }
  }
});

const thirdDiceChart = new Chart(document.getElementById('thirdDiceChart'), {
  type: 'pie',
  data: {
    labels: thirdDiceFaces,
    datasets: [{
      label: 'Barbarenw√ºrfel',
      data: thirdDiceStats,
      backgroundColor: ['#2ecc71', '#e74c3c']
    }]
  },
  options: {
    plugins: {
      datalabels: {
        formatter: (value, ctx) => {
          const sum = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
          return sum ? (value / sum * 100).toFixed(1) + '%' : '0%';
        },
        color: '#000',
        font: {
          size: 22
        }
      },
      legend: {
        labels: {
          color: '#000',
          font: {
            size: 22
          }
        }
      }
    }
  }
});

   const fourthDiceChart = new Chart(document.getElementById('fourthDiceChart'), {
  type: 'pie',
  data: {
    labels: fourthDiceNames,
    datasets: [{
      label: 'Handelsgildenfarbe',
      data: fourthDiceStats,
      backgroundColor: ['#3498db', '#f1c40f', '#2ecc71', '#e84393', '#e74c3c', '#34495e']
    }]
  },
  options: {
    plugins: {
      datalabels: {
        formatter: (value, ctx) => {
          const sum = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
          return sum ? (value / sum * 100).toFixed(1) + '%' : '0%';
        },
        color: '#000',
        font: {
          size: 22
        }
      },
      legend: {
        labels: {
          color: '#000',
          font: {
            size: 22
          }
        }
      }
    }
  }
});


    function rollDice() {
      totalRolls++;

      if (settings.globalEffects) {
        if (totalRolls >= 7 && (totalRolls - 7) % 8 === 0) {
          lastGlobalEffect = globalEffects[Math.floor(Math.random() * globalEffects.length)];
          document.getElementById("globalEffectBox").textContent = lastGlobalEffect;
          document.getElementById("globalEffectBox").style.display = "block";
        } else if (lastGlobalEffect) {
          document.getElementById("globalEffectBox").textContent = lastGlobalEffect;
          document.getElementById("globalEffectBox").style.display = "block";
        }
      } else {
        document.getElementById("globalEffectBox").style.display = "none";
      }

      if (rollingDisabled) return;
      rollingDisabled = true;

      const number1 = Math.floor(Math.random() * 6) + 1;
      const number2 = Math.floor(Math.random() * 6) + 1;
      const third = Math.floor(Math.random() * 6);
      const fourth = Math.floor(Math.random() * 6);

      const thirdOutcome = third < 3 ? 'Vorr√ºcken' : 'Stehenbleiben';
      const fourthColor = fourthDiceColors[fourth];
      const fourthText = fourthDiceNames[fourth];
      const sum = number1 + number2;

      document.getElementById('dice1').textContent = settings.normalDice ? diceFaces[number1 - 1] : '‚ùå';
      document.getElementById('dice2').textContent = settings.normalDice ? diceFaces[number2 - 1] : '‚ùå';
      document.getElementById('dice3').textContent = settings.barbarianDice ? (thirdOutcome === 'Vorr√ºcken' ? '‚û°Ô∏è' : '‚õîÔ∏è') : '‚ùå';
      document.getElementById('dice4').textContent = settings.guildDice ? fourthColor : '‚ùå';

      document.getElementById('result').textContent = settings.normalDice ? `Gesamtergebnis: ${sum}` : '';
      document.getElementById('thirdResult').textContent = settings.barbarianDice ? `Barbarenw√ºrfel: ${thirdOutcome}` : '';
      document.getElementById('fourthResult').textContent = settings.guildDice ? `Handelsgilde: ${fourthText}` : '';

      if (settings.normalDice) stats[sum - 2]++;
      if (settings.barbarianDice) (thirdOutcome === 'Vorr√ºcken' ? thirdDiceStats[0]++ : thirdDiceStats[1]++);
      if (settings.guildDice) fourthDiceStats[fourth]++;

      localStorage.setItem("diceStats", JSON.stringify(stats));
      localStorage.setItem("thirdDiceStats", JSON.stringify(thirdDiceStats));
      localStorage.setItem("fourthDiceStats", JSON.stringify(fourthDiceStats));

      statsChart.update();
      thirdDiceChart.update();
      fourthDiceChart.update();

      if (settings.normalDice) {
  speak(`Es wurde eine ${sum} gew√ºrfelt.`);
  speak(`Das Barbarenschiff muss ${thirdOutcome}.`);
  speak(`Die ${fourthText} Handelsgilde ist an der Macht.`);      
}


      if (sum === 7 && settings.effectsOnSeven) {
        const randomEffect = effects[Math.floor(Math.random() * effects.length)];
        const [title, ...textParts] = randomEffect.split(":");
        document.getElementById('effectTitle').textContent = title?.trim() || "Ereignis";
        document.getElementById('effectText').textContent = textParts.join(":").trim();
        document.getElementById('effectBox').style.display = 'block';
      } else {
        rollingDisabled = false;
      }
    }

    function closeEffect() {
      document.getElementById('effectBox').style.display = 'none';
      rollingDisabled = false;
    }

    function toggleEdit() {
      const area = document.getElementById('editArea');
      const input = document.getElementById('effectInput');
      if (area.style.display === 'none') {
        input.value = effects.join("\n");
        area.style.display = 'block';
      } else {
        area.style.display = 'none';
      }
    }

    function toggleGlobalEdit() {
      const area = document.getElementById('globalEditArea');
      const input = document.getElementById('globalEffectInput');
      if (area.style.display === 'none') {
        input.value = globalEffects.join("\n");
        area.style.display = 'block';
      } else {
        area.style.display = 'none';
      }
    }

    function saveEffects() {
      const input = document.getElementById("effectInput").value;
      effects = input.split("\n").map(e => e.trim()).filter(e => e);
      localStorage.setItem("sevenEffects", JSON.stringify(effects));
      document.getElementById("editArea").style.display = "none";
    }

    function saveGlobalEffects() {
      const input = document.getElementById("globalEffectInput").value;
      globalEffects = input.split("\n").map(e => e.trim()).filter(e => e);
      localStorage.setItem("globalEffects", JSON.stringify(globalEffects));
      document.getElementById("globalEditArea").style.display = "none";
    }

    function resetStats() {
      stats = Array(11).fill(0);
      thirdDiceStats = [0, 0];
      fourthDiceStats = Array(6).fill(0);
      localStorage.setItem("diceStats", JSON.stringify(stats));
      localStorage.setItem("thirdDiceStats", JSON.stringify(thirdDiceStats));
      localStorage.setItem("fourthDiceStats", JSON.stringify(fourthDiceStats));
      statsChart.data.datasets[0].data = stats;
      thirdDiceChart.data.datasets[0].data = thirdDiceStats;
      fourthDiceChart.data.datasets[0].data = fourthDiceStats;
      statsChart.update();
      thirdDiceChart.update();
      fourthDiceChart.update();
    }

    function toggleStats() {
      const statsContainer = document.getElementById('statsContainer');
      statsContainer.style.display = statsContainer.style.display === 'none' ? 'flex' : 'none';
    }

    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && ['u', 'c', 'x', 's'].includes(e.key.toLowerCase())) {
        e.preventDefault();
      }
    });
    const toggleButton = document.getElementById("dropdownToggle");
const menu = document.getElementById("dropdownMenu");

toggleButton.addEventListener("click", () => {
  menu.style.display = menu.style.display === "block" ? "none" : "block";
});

document.addEventListener("click", (e) => {
  if (!document.getElementById("dropdownContainer").contains(e.target)) {
    menu.style.display = "none";
  }
});
  </script>
</body>
</html>
